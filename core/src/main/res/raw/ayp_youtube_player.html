<!DOCTYPE html>
<html>
  <style type="text/css">
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            background-color: #000000;
            overflow: hidden;
            position: fixed;
        }
    </style>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- defer forces the library to execute after the html page is fully parsed. -->
    <!-- This is needed to avoid race conditions, where the library executes and calls `onYouTubeIframeAPIReady` before the page is fully parsed. -->
    <!-- See #873 on GitHub -->
    <script defer src="https://www.youtube.com/iframe_api"></script>
  </head>

  <body>
    <div id="youTubePlayerDOM"></div>
  </body>

  <script type="text/javascript">
    var UNSTARTED = "UNSTARTED";
    var ENDED = "ENDED";
    var PLAYING = "PLAYING";
    var PAUSED = "PAUSED";
    var BUFFERING = "BUFFERING";
    var CUED = "CUED";

    var YouTubePlayerBridge = window.YouTubePlayerBridge;
    var player;

    var timerId;

    function onYouTubeIframeAPIReady() {

      YouTubePlayerBridge.sendYouTubeIFrameAPIReady();
            
    	player = new YT.Player('youTubePlayerDOM', {
    			
        height: '100%',
    	  width: '100%',
    			
        events: {
    	    onReady: function(event) { YouTubePlayerBridge.sendReady() },
    		  onStateChange: function(event) { sendPlayerStateChange(event.data) },
    		  onPlaybackQualityChange: function(event) { YouTubePlayerBridge.sendPlaybackQualityChange(event.data) },
    		  onPlaybackRateChange: function(event) { YouTubePlayerBridge.sendPlaybackRateChange(event.data) },
    		  onError: function(error) { YouTubePlayerBridge.sendError(error.data) },
    		  onApiChange: function(event) { YouTubePlayerBridge.sendApiChange() }
    	  },

    	  playerVars: <<injectedPlayerVars>>

      });
    }

    function sendPlayerStateChange(playerState) {
      clearTimeout(timerId);
      initializeAdBlock();

      switch (playerState) {
        case YT.PlayerState.UNSTARTED:
          sendStateChange(UNSTARTED);
          sendVideoIdFromPlaylistIfAvailable(player);
          return;

        case YT.PlayerState.ENDED:
          sendStateChange(ENDED);
          return;

        case YT.PlayerState.PLAYING:
          sendStateChange(PLAYING);

          startSendCurrentTimeInterval();
          sendVideoData(player);
          return;

        case YT.PlayerState.PAUSED:
          sendStateChange(PAUSED);
          return;

        case YT.PlayerState.BUFFERING:
          sendStateChange(BUFFERING);
          return;

        case YT.PlayerState.CUED:
          sendStateChange(CUED);
          return;
      }

      function sendVideoData(player) {
        var videoDuration = player.getDuration();

        YouTubePlayerBridge.sendVideoDuration(videoDuration);
      }

      // This method checks if the player is playing a playlist.
      // If yes, it sends out the video id of the video being played.
      function sendVideoIdFromPlaylistIfAvailable(player) {
        var playlist = player.getPlaylist();
        if ( typeof playlist !== 'undefined' && Array.isArray(playlist) && playlist.length > 0 ) {
          var index = player.getPlaylistIndex();
          var videoId = playlist[index];
          YouTubePlayerBridge.sendVideoId(videoId);
        }
      }

      function sendStateChange(newState) {
        YouTubePlayerBridge.sendStateChange(newState)
      }

      function startSendCurrentTimeInterval() {
        timerId = setInterval(function() {
          YouTubePlayerBridge.sendVideoCurrentTime( player.getCurrentTime() )
          YouTubePlayerBridge.sendVideoLoadedFraction( player.getVideoLoadedFraction() )
        }, 100 );
      }
    }

    // JAVA to WEB functions

    function seekTo(startSeconds) {
      player.seekTo(startSeconds, true);
    }

    function pauseVideo() {
      player.pauseVideo();
    }

    function playVideo() {
      player.playVideo();
    }

    function loadVideo(videoId, startSeconds) {
      player.loadVideoById(videoId, startSeconds);
      YouTubePlayerBridge.sendVideoId(videoId);
    }

    function cueVideo(videoId, startSeconds) {
      player.cueVideoById(videoId, startSeconds);
      YouTubePlayerBridge.sendVideoId(videoId);
    }

    function mute() {
      player.mute();
    }

    function unMute() {
      player.unMute();
    }

    function setVolume(volumePercent) {
      player.setVolume(volumePercent);
    }

    function setPlaybackRate(playbackRate) {
      player.setPlaybackRate(playbackRate);
    }

    function toggleFullscreen() {
      player.toggleFullscreen();
    }

    function hideVideoTitle() {
      hideVideoTitleOnce()
      setInterval(hideVideoTitleOnce, 1000);
    }

    function hideVideoTitleOnce() {
      const playerIFrame = document.querySelector("iframe");
      if (!playerIFrame) {
        return;
      }

      const frameDoc = playerIFrame.contentDocument;
      if (!frameDoc) {
        return;
      }

      const title = frameDoc.querySelector('.ytp-chrome-top');
      if (title) {
        title.style.display = 'none';
      }
    }

    function disableVideoTitle() {
      disableVideoTitleOnce()
      setInterval(disableVideoTitleOnce, 1000);
    }

    function disableVideoTitleOnce() {
      const playerIFrame = document.querySelector("iframe");
      if (!playerIFrame) {
        return;
      }

      const frameDoc = playerIFrame.contentDocument;
      if (!frameDoc) {
        return;
      }

      const title = frameDoc.querySelector('.ytp-chrome-top');
      if (title) {
        title.style.pointerEvents = 'none';
        title.style.touchAction = 'none';
      }
    }

    function hideTabletPopup() {
      hideTabletPopupOnce()
      setInterval(hideTabletPopupOnce, 1000);
    }

    function hideTabletPopupOnce() {
      const playerIFrame = document.querySelector("iframe");
      if (!playerIFrame) {
        return;
      }

      const frameDoc = playerIFrame.contentDocument;
      if (!frameDoc) {
        return;
      }

      const collection = frameDoc.getElementsByClassName("ytp-pause-overlay-container")[0];
      if (!collection) {
        return;
      }
      collection.style.display = 'none';
    }

    function disableTabletPopup() {
      disableTabletPopupOnce()
      setInterval(disableTabletPopupOnce, 1000);
    }

    function disableTabletPopupOnce() {
      const playerIFrame = document.querySelector("iframe");
      if (!playerIFrame) {
        return;
      }

      const frameDoc = playerIFrame.contentDocument;
      if (!frameDoc) {
        return;
      }

      const collection = frameDoc.getElementsByClassName("ytp-pause-overlay-container")[0];
      if (!collection) {
        return;
      }
      collection.style.display = 'none';
    }

    function hideBranding() {
      hideBrandingOnce()
      setInterval(hideBrandingOnce, 1000);
    }

    function hideBrandingOnce() {
      const playerIFrame = document.querySelector("iframe");
      if (!playerIFrame) {
        return;
      }

      const frameDoc = playerIFrame.contentDocument;
      if (!frameDoc) {
        return;
      }

      const branding = frameDoc.querySelectorAll('.iv-branding')[0];
      if (branding) {
        branding.style.display = 'none';
      }
    }

    function disableBranding() {
      disableBrandingOnce()
      setInterval(disableBrandingOnce, 1000);
    }

    function disableBrandingOnce() {
      const playerIFrame = document.querySelector("iframe");
      if (!playerIFrame) {
        return;
      }

      const frameDoc = playerIFrame.contentDocument;
      if (!frameDoc) {
        return;
      }

      const branding = frameDoc.querySelectorAll('.iv-branding')[0];
      if (branding) {
        branding.style.pointerEvents = 'none';
        branding.style.touchAction = 'none';
      }
    }

    function hideSettingsMoreOptions() {
      hideSettingsMoreOptionsOnce()
      setInterval(hideSettingsMoreOptionsOnce, 1000);
    }

    function hideSettingsMoreOptionsOnce() {
      const playerIFrame = document.querySelector("iframe");
      if (!playerIFrame) {
        return;
      }

      const frameDoc = playerIFrame.contentDocument;
      if (!frameDoc) {
        return;
      }

      const s_popup = frameDoc.querySelector(".ytp-settings-menu");
      const moreOptionsItem = selectItem(s_popup, ".ytp-menuitem", "More options");

      if (moreOptionsItem) {
        moreOptionsItem.style.display = 'none';
      }
    }

    function disableSettingsMoreOptions() {
      disableSettingsMoreOptionsOnce()
      setInterval(disableSettingsMoreOptionsOnce, 1000);
    }

    function disableSettingsMoreOptionsOnce() {
      const playerIFrame = document.querySelector("iframe");
      if (!playerIFrame) {
        return;
      }

      const frameDoc = playerIFrame.contentDocument;
      if (!frameDoc) {
        return;
      }

      const s_popup = frameDoc.querySelector(".ytp-settings-menu");
      const moreOptionsItem = selectItem(s_popup, ".ytp-menuitem", "More options");

      if (moreOptionsItem) {
        // Stop receiving any mouse or touch events, effectively making it unclickable.
        moreOptionsItem.style.pointerEvents = 'none';
        moreOptionsItem.style.touchAction = 'none';
      }
    }


    function hideMoreOptionsPopUp() {
      hideMoreOptionsPopUpOnce()
      setInterval(hideMoreOptionsPopUpOnce, 1000);
    }

    function hideMoreOptionsPopUpOnce() {
      const playerIFrame = document.querySelector("iframe");
      if (!playerIFrame) {
        return;
      }

      const frameDoc = playerIFrame.contentDocument;
      if (!frameDoc) {
        return;
      }

      const s_popup = frameDoc.querySelector(".ytp-contextmenu");
      if (!s_popup) {
        return;
      }
      s_popup.style.visibility = 'hidden';
      s_popup.style.display = 'none';

      const allOptions = s_popup.querySelectorAll(".ytp-menuitem");
      if (!allOptions) {
        return;
      }
      allOptions.every(hideMenuItem);
    }

    function hideMenuItem(menuItem) {
      if (menuItem) {
        // Stop receiving any mouse or touch events, effectively making it unclickable.
        menuItem.style.pointerEvents = 'none';
        menuItem.style.touchAction = 'none';
        menuItem.style.display = 'none';
        menuItem.style.visibility = 'hidden';
      }
    }

    function disableMoreOptionsPopUp() {
      disableMoreOptionsPopUpOnce()
      setInterval(disableMoreOptionsPopUpOnce, 1000);
    }

    function disableMoreOptionsPopUpOnce() {
      const playerIFrame = document.querySelector("iframe");
      if (!playerIFrame) {
        return;
      }

      const frameDoc = playerIFrame.contentDocument;
      if (!frameDoc) {
        return;
      }

      const s_popup = frameDoc.querySelector(".ytp-contextmenu");
      if (!s_popup) {
        return;
      }
      s_popup.style.pointerEvents = 'none';
      s_popup.style.touchAction = 'none';

      // const allOptions = s_popup.querySelectorAll(".ytp-menuitem");
      // if (!allOptions) {
      //   return;
      // }
      // allOptions.every(hideMenuItem);
    }

    function hideMenuItem(menuItem) {
      if (menuItem) {
        // Stop receiving any mouse or touch events, effectively making it unclickable.
        menuItem.style.pointerEvents = 'none';
        menuItem.style.touchAction = 'none';
      }
    }

    // helper function:
    // select by css selector,
    // or by selector & text
    function selectItem(node, selector, text) {
      if (text) {
        const result = Array.from(node.querySelectorAll(selector))
                .find(item => item.innerText.includes(text));
        return result;
      } else {
        return node.querySelector(selector);
      }
    }

    function hideCaption() {
      hideCaptionOnce()
      setInterval(hideCaptionOnce, 1000);
    }

    function hideCaptionOnce() {
      if (!player) {
        return;
      }
      player.unloadModule('captions');
    }


    function disableYoutubePlayerUselessViews() {
      disableYoutubePlayerUselessViewsOnce()
      setInterval(disableYoutubePlayerUselessViewsOnce, 1000)
    }

    function disableYoutubePlayerUselessViewsOnce() {
      disableBrandingOnce()
      disableSettingsMoreOptionsOnce()
      disableMoreOptionsPopUpOnce()
    }

    let adblockIntervalId;

    function initializeAdBlock() {
      if (adblockIntervalId) {
        clearInterval(adblockIntervalId);
      }

      const playerIFrame = document.querySelector("iframe");
      if (playerIFrame) {
        adblockIntervalId = setInterval(() => {
          if (!playerIFrame) {
            return;
          }

          const frameDoc = playerIFrame.contentDocument;
          if (!frameDoc) {
            return;
          }

          const adsContainer = frameDoc.querySelector('.video-ads');
          if (!adsContainer || adsContainer.childElementCount == 0) {
            return;
          }

          const adsVideo = adsContainer.querySelector("video");

          if (adsVideo) {
            adsVideo.muted = true;
            adsVideo.style.display = 'none';
            adsVideo.currentTime = adsVideo.duration - 0.15;
            adsVideo.muted = false;
            adsVideo.style.display = '';
            if (adblockIntervalId) {
              clearInterval(adblockIntervalId);
            }
          } else {
            const isAdShowing = frameDoc.getElementsByClassName('ad-showing').length != 0;
            if (!isAdShowing) {
              return;
            }

            const mainVideo = frameDoc.querySelector('.html5-main-video');
            if (!mainVideo) {
              return;
            }

            mainVideo.muted = true;
            mainVideo.currentTime = mainVideo.duration - 0.15;
            mainVideo.muted = false;
            if (adblockIntervalId) {
              clearInterval(adblockIntervalId);
            }
          }
        }, 100);
      }
    }


  </script>
</html>
